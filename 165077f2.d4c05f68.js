(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{105:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return s})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return b}));var r=a(2),n=a(6),o=(a(0),a(144)),s={id:"flashSwap",title:"Flash Swap",sidebar_label:"Flash Swap"},c={id:"flashSwap",isDocsHomePage:!1,title:"Flash Swap",description:"What is flash swap",source:"@site/docs/flashSwap.md",permalink:"/docs/docs/flashSwap",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/flashSwap.md",sidebar_label:"Flash Swap",sidebar:"someSidebar",previous:{title:"Use Guide",permalink:"/docs/docs/contractUseGuide"},next:{title:"Deployed Infomation",permalink:"/docs/docs/deployedInfo"}},l=[{value:"What is flash swap",id:"what-is-flash-swap",children:[]},{value:"How does flash swap work",id:"how-does-flash-swap-work",children:[]},{value:"What can flash swap do",id:"what-can-flash-swap-do",children:[]},{value:"\u5173\u4e8e flash swap \u7684\u4e00\u4e9b\u60f3\u6cd5",id:"\u5173\u4e8e-flash-swap-\u7684\u4e00\u4e9b\u60f3\u6cd5",children:[]}],i={rightToc:l};function b(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},i,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"what-is-flash-swap"},"What is flash swap"),Object(o.b)("p",null,"\u7b80\u5355\u6765\u8bb2\uff0c\u5c31\u662f\u5141\u8bb8\u4f60\u8d4a\u8d26\uff01\u5f53\u4f60\u5728 DODO buy/sell \u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u5148\u83b7\u5f97\u8981\u8d2d\u4e70\u7684 token\uff0cdo anything you want with \u8fd9\u7b14\u94b1\u3002\u4e4b\u540e\u518d\u652f\u4ed8\u8d27\u6b3e\u3002"),Object(o.b)("p",null,"Simply put, you are allowed to pay on credit! When you buy or sell on DODO, you can first get the token you want to buy, do anything you want with the token and then pay for it later."),Object(o.b)("h2",{id:"how-does-flash-swap-work"},"How does flash swap work"),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"https://dodoex.github.io/docs/img/dodo_flash_swap.jpeg",alt:null}))),Object(o.b)("p",null,"The picture above shows the four steps to make flash swap"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Call the buyBaseToken of the DODO smart contract"),Object(o.b)("li",{parentName:"ol"},"DODO will transfer the Base token to the message sender first"),Object(o.b)("li",{parentName:"ol"},"If the parameter Data of buyBaseToken is not null, the DODO smart contract will call the dodoCall method of the message sender"),Object(o.b)("li",{parentName:"ol"},"After the dodoCall is executed, the DODO smart contract will retrieve the quote token required for this transaction from the message sender")),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"The sellBaseToken can also perform flash swap in the same way."))),Object(o.b)("p",null,"Flash swap requires the message sender to be a contract that follows below interface."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-javascript"}),"interface IDODOCallee {\n    function dodoCall(\n        bool isBuyBaseToken,\n        uint256 baseAmount,\n        uint256 quoteAmount,\n        bytes calldata data\n    ) external;\n}\n")),Object(o.b)("h2",{id:"what-can-flash-swap-do"},"What can flash swap do"),Object(o.b)("p",null,"Flash swap can significantly improve market effectiveness."),Object(o.b)("p",null,"Market parity is maintained by arbitrageurs. Flash swap can completely eliminate the arbitrageur\u2019s capital requirements, greatly reduce the arbitrage threshold, and promote market effectiveness. Here we will demonstrate a completely trustless and risk free arbitrage contract as a use case of swap flash."),Object(o.b)("p",null,Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/radar-bear/dodo-smart-contract/blob/master/contracts/helper/UniswapArbitrageur.sol"}),"source code")),Object(o.b)("p",null,Object(o.b)("a",Object(r.a)({parentName:"p"},{href:""}),"deployed address")),Object(o.b)("p",null,Object(o.b)("img",Object(r.a)({parentName:"p"},{src:"https://dodoex.github.io/docs/img/dodo_one_click_arbitrage.jpeg",alt:null}))),Object(o.b)("p",null,"\u4e00\u7b14\u5957\u5229\u7531\u4ee5\u4e0b 9 \u4e2a\u6b65\u9aa4\u7ec4\u6210\uff1a"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"User calls executeBuyArbitrage on Arbitrageur Contract"),Object(o.b)("li",{parentName:"ol"},"Arbitrageur Contract calls buyBaseToken on DODO and triggers flash swap"),Object(o.b)("li",{parentName:"ol"},"DODO transfers 1 WETH to Arbitrageur Contract"),Object(o.b)("li",{parentName:"ol"},"DODO calls dodoCall on Arbitrageur Contract"),Object(o.b)("li",{parentName:"ol"},"Arbitrageur Contract transfers 1 WETH received from DODO to UniswapV2"),Object(o.b)("li",{parentName:"ol"},"Arbitrageur Contract call swap on UniswapV2"),Object(o.b)("li",{parentName:"ol"},"UniswapV2 transfers 200 USDC to Arbitrageur Contract"),Object(o.b)("li",{parentName:"ol"},"DODO call transferFrom and retrieve 150 USDC from Arbitrageur Contract"),Object(o.b)("li",{parentName:"ol"},"Arbitrageur Contract transfers the remaining 50 USDC to User")),Object(o.b)("p",null,"An arbitrage consists of the following 9 steps:\nUser calls executeBuyArbitrage on Arbitrageur Contract\nArbitrageur Contract calls buyBaseToken on DODO and triggers flash swap\nDODO transfers 1 WETH to Arbitrageur Contract\nDODO calls dodoCall on Arbitrageur Contract\nArbitrageur Contract transfers 1 WETH received from DODO to UniswapV2\nArbitrageur Contract call swap on UniswapV2\nUniswapV2 transfers 200 USDC to Arbitrageur Contract\nDODO call transferFrom and retrieve 150 USDC from Arbitrageur Contract\nArbitrageur Contract transfers the remaining 50 USDC to User"),Object(o.b)("p",null,"\u603b\u7ed3\u8d77\u6765\u5c31\u662f"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"step 2\uff0c3\uff0c4\uff0c8 \u6784\u6210\u4e86 flash swap"),Object(o.b)("li",{parentName:"ul"},"step 5\uff0c6\uff0c7 \u6784\u6210\u4e86 uniswap"),Object(o.b)("li",{parentName:"ul"},"\u5728\u7528\u6237\u770b\u6765\u53ea\u53d1\u751f\u4e86\u4e24\u4ef6\u4e8b\uff0c\u53d1\u9001 transaction \u548c\u76c8\u5229")),Object(o.b)("p",null,"\u8fd9\u4e2a\u5408\u7ea6\u7684\u725b\u903c\u4e4b\u5904\u5728\u4e8e\uff0c\u7528\u6237\u4e0d\u9700\u8981\u4efb\u4f55\u8d44\u672c\uff0c\u4e5f\u4e0d\u9700\u8981\u77e5\u9053 dodo \u548c uniswap \u7684\u5b58\u5728\u3002\u53ea\u8981 call function\u3002\u5982\u679c\u6267\u884c\u6210\u529f\u5c31\u4e00\u5b9a\u4f1a\u6323\u94b1\uff0c\u5982\u679c\u6267\u884c\u5931\u8d25\u4e5f\u53ea\u635f\u5931 gas\u3002"),Object(o.b)("p",null,"\u5f53\u7136\u4e3a\u4e86\u907f\u514d\u65e0\u610f\u4e49\u7684 gas \u6d88\u8017\uff0c\u6211\u4eec\u5efa\u8bae\u7528\u6237\u9884\u5148\u4f7f\u7528",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://infura.io/docs/ethereum/json-rpc/eth-call"}),"eth_call"),"\u6267\u884c",Object(o.b)("inlineCode",{parentName:"p"},"executeBuyArbitrage"),"\u6216",Object(o.b)("inlineCode",{parentName:"p"},"executeSellArbitrage"),"\u4f30\u8ba1\u5957\u5229\u6536\u76ca\u3002\u5982\u679c\u6709\u5957\u5229\u673a\u4f1a\uff0c\u5219\u8fd9\u4e24\u4e2a\u51fd\u6570\u5206\u522b\u4f1a\u8fd4\u56de\u6267\u884c\u6210\u529f\u540e\u7684 quote token \u548c base token \u6536\u76ca\u3002"),Object(o.b)("h2",{id:"\u5173\u4e8e-flash-swap-\u7684\u4e00\u4e9b\u60f3\u6cd5"},"\u5173\u4e8e flash swap \u7684\u4e00\u4e9b\u60f3\u6cd5"),Object(o.b)("p",null,"\u4e00\u65e6\u4f60\u6df1\u5165\u7406\u89e3\u4e86 flash swap\uff0c\u5c31\u4f1a\u53d1\u73b0 defi \u4e16\u754c\u76f8\u8f83\u4e8e\u4e2d\u5fc3\u5316\u4e16\u754c\u7684\u4f18\u8d8a\u6027\u3002\u667a\u80fd\u5408\u7ea6\u7684\u53ef\u7ec4\u5408\u6027\u4f7f\u5f97 defi \u7684\u8d44\u91d1\u5229\u7528\u7387\u63d0\u9ad8\u5230\u4e86\u524d\u6240\u672a\u6709\u7684\u9ad8\u5ea6\uff0c\u53c8\u56e0\u4e3a trustless\uff0cdefi \u4e16\u754c\u7684\u4fe1\u8d37\u6210\u672c\u4f4e\u5230\u4e0d\u53ef\u601d\u8bae\u3002\u4e00\u65e6\u8fd9\u79cd\u91d1\u878d\u5236\u5ea6\u53ef\u4ee5\u548c\u73b0\u5b9e\u4e16\u754c\u7ed3\u5408\uff0c\u5bf9\u4eba\u7c7b\u751f\u4ea7\u529b\u7684\u4fc3\u8fdb\u662f\u96be\u4ee5\u60f3\u8c61\u7684\u3002"),Object(o.b)("p",null,"\u6211\u7ed9\u5f88\u591a\u4eba\u8bb2\u8fc7\u667a\u80fd\u5408\u7ea6\u7684\u8ff7\u4eba\u4e4b\u5904\uff0c\u5374\u5c11\u6709\u4eba\u80fd\u4f53\u4f1a\u3002\u5e0c\u671b flash swap \u53ef\u4ee5\u6210\u4e3a\u4e00\u4e2a\u666e\u901a\u4eba\u4e5f\u80fd\u7406\u89e3\u7684\u6709\u8da3\u6848\u4f8b\u3002"),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(r.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(r.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(r.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(r.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Flash swap is inspired by ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://dydx.exchange/"}),"DyDx")," and ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://uniswap.org/docs/v2/core-concepts/flash-swaps"}),"Uniswap"),". We really appriciate what they have done before!"))))}b.isMDXComponent=!0},144:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return h}));var r=a(0),n=a.n(r);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var i=n.a.createContext({}),b=function(e){var t=n.a.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},p=function(e){var t=b(e.components);return n.a.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},u=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,i=l(e,["components","mdxType","originalType","parentName"]),p=b(a),u=r,h=p["".concat(s,".").concat(u)]||p[u]||d[u]||o;return a?n.a.createElement(h,c(c({ref:t},i),{},{components:a})):n.a.createElement(h,c({ref:t},i))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,s=new Array(o);s[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var i=2;i<o;i++)s[i]=a[i];return n.a.createElement.apply(null,s)}return n.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);